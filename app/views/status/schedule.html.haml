.row
	.col-md-12
		%h1 Schedule for #{Course.find(params[:course_id]).name}
.row
	.col-md-12
		#cal
.row
	.col-md-12(style="margin-top:30px")
		%table.table.table-compact.table-striped
			%thead
				%tr
					%th Uhrzeit
					%th Raum
					%th Gruppe
					%th Tutor

			%tbody
				- Group.includes([:user,:course]).order(:start).each do |g|
					- if g.course.id == params[:course_id].to_i
						%tr
							%td= g.start.strftime("%a %H:%M")
							%td= g.room
							%td= g.name
							%td
								%a(href="mailto:#{g.user.email}")= g.user.name

:coffeescript
	groups = #{Group.find(:all, :joins => :course, :conditions => ["courses.id = ?", params[:course_id]]).to_json(:only => [:name,:start,:room,:updated_at], :include => { :user => { :only => [ :firstname, :lastname, :email ]} })};
	$(document).ready =>
		events=[]
		for group in groups
			events.push
				title: "\#{group.name.replace(/Gruppe /,'')}, \#{group.room}\n\#{group.user.firstname.substr(0,1)}. \#{group.user.lastname}"
				group: group
				start: new Date(new Date(group.start).getTime() + new Date().getTimezoneOffset() * 60000)
				end: new Date(new Date(group.start).getTime() + new Date().getTimezoneOffset() * 60000 + 90 * 60000)
				allDay: false
				color: if (new Date(group.updated_at) < new Date("2013-10-25 15:41:17 +0200")) then 'red' else 'green'
		window.buildCalendar("cal", events, (=>))
